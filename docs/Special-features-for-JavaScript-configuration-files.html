

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>JavaScript配置文件的特殊功能 &mdash; node-config docs v2019.06.28 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="常见用法" href="Common-Usage.html" />
    <link rel="prev" title="配置文件" href="Configuration-Files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> node-config docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">内容:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Home.html">维基页面</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration-Files.html">配置文件</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">JavaScript配置文件的特殊功能</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#deferred-values-in-javascript-configuration-files">Deferred values in JavaScript configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-promises-process-stdout-and-other-objects-in-javascript-config-files">Using promises, process.stdout and other objects in JavaScript config files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#including-other-files">Including other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Common-Usage.html">常见用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="Environment-Variables.html">环境变量</a></li>
<li class="toctree-l1"><a class="reference internal" href="Environment-Variables.html#id3">Custom Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reserved-Words.html">保留字</a></li>
<li class="toctree-l1"><a class="reference internal" href="Command-Line-Overrides.html">命令行覆盖</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multiple-Node-Instances.html">多节点实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sub-Module-Configuration.html">子模块配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuring-from-an-External-Source.html">从外部源配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="External-Configuration-Management-Tools.html">外部配置管理工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examining-Configuration-Sources.html">检查配置源</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using-Config-Utilities.html">使用配置实用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="Community-Utilities.html">社区公用事业</a></li>
<li class="toctree-l1"><a class="reference internal" href="Future-Compatibility.html">未来兼容性</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upgrading-From-Config-0.x.html">从Config 0.x升级</a></li>
<li class="toctree-l1"><a class="reference internal" href="Plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="Altering-configuration-values-for-testing-at-runtime.html">更改配置值以便在运行时进行测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="Asynchronous-Configurations.html">异步配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuring-from-a-DB.html">从DB配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="Securing-Production-Config-Files.html">保护生产配置文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="Strict-Mode.html">严格的模式</a></li>
<li class="toctree-l1"><a class="reference internal" href="Webpack-Usage.html">Webpack用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="_Footer.html">页脚</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">node-config docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>JavaScript配置文件的特殊功能</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Special-features-for-JavaScript-configuration-files.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="special-features-for-javascript-configuration-files">
<h1>JavaScript配置文件的特殊功能<a class="headerlink" href="#special-features-for-javascript-configuration-files" title="永久链接至标题">¶</a></h1>
<p>Files ending in <code class="docutils literal notranslate"><span class="pre">.js</span></code> are loaded and run as a JavaScript module. The
module must export the configuration object. Some folks appreciate the
ability to compute configurations, others feel it’s not the right thing
to do. It’s nice to live in a world with choice.</p>
<p>JavaScript modules support the ability to have “deferred” and “raw”
values.</p>
<div class="section" id="deferred-values-in-javascript-configuration-files">
<h2>Deferred values in JavaScript configuration files<a class="headerlink" href="#deferred-values-in-javascript-configuration-files" title="永久链接至标题">¶</a></h2>
<p>In the JavaScript modules you have the option to define a configuration
value as a function whose resolution will be deferred until the final
merged configuration structure is built.</p>
<p>For example, you set up a default value for a “full name” that is
calculated from “first name” and “last name” values which will be
provided a config file which overrides the defaults.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// In default.js</span>
<span class="c1">// using defer functions is optional. See example and docs below.</span>
<span class="kd">var</span> <span class="nx">defer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;config/defer&#39;</span><span class="p">).</span><span class="nx">deferConfig</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">firstName</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="nx">lastName</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="nx">fullName</span> <span class="o">:</span> <span class="nx">defer</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">;</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then in <code class="docutils literal notranslate"><span class="pre">config/production.js</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">firstName</span> <span class="p">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span>
   <span class="n">lastName</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because the resolution of <code class="docutils literal notranslate"><span class="pre">fullName</span></code> is deferred, it would resolve to
refer to the overridden first and last name.</p>
<p>The use of <a class="reference external" href="http://javascriptplayground.com/blog/2013/12/es5-getters-setters/">ECMAScript 5
getters</a>
in JavaScript configurations is not supported. Using deferred
configuration values is the recommended alternative.</p>
</div>
<div class="section" id="using-promises-process-stdout-and-other-objects-in-javascript-config-files">
<h2>Using promises, process.stdout and other objects in JavaScript config files<a class="headerlink" href="#using-promises-process-stdout-and-other-objects-in-javascript-config-files" title="永久链接至标题">¶</a></h2>
<p>There may be instances where you would like to place a complex object
like <code class="docutils literal notranslate"><span class="pre">process.stdout</span></code> into your configuration file, e.g. logging
configuration. But node-config achieves its useful functionality by
modifying the config object prototypes then making them immutable - not
ideal for <code class="docutils literal notranslate"><span class="pre">process.stdout</span></code>! But you can still achieve the goal by
using the <code class="docutils literal notranslate"><span class="pre">raw</span></code> functionality like so:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;config/raw&#39;</span><span class="p">).</span><span class="nx">raw</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">logOutputStream</span><span class="o">:</span> <span class="nx">raw</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Promises or other objects can be included in JavaScript files using the
same method.</p>
</div>
<div class="section" id="including-other-files">
<h2>Including other files<a class="headerlink" href="#including-other-files" title="永久链接至标题">¶</a></h2>
<p>If you’d like to include values from another file in JavaScript, no
special syntax is required–the full features of Node.js are already
available!</p>
<p>``` config = { // Load credit configs externally credit:
JSON.parse(fs.readFileSync(‘./currentCreditPolicy.json’)) }</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Common-Usage.html" class="btn btn-neutral float-right" title="常见用法" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Configuration-Files.html" class="btn btn-neutral float-left" title="配置文件" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>